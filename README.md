# MoonCam 📹

**MoonCam** 是一个轻量级的 RTSP 拉流工具，支持将 H.264/H.265 视频流独立分片保存，并自动上传至阿里云盘进行备份。每个文件可以独立播放并转为mp4等格式

---

## 🚀 功能特性

- ✅ **RTSP 拉流**：高效拉取网络摄像头视频流
- ✅ **分片保存**：按时间和片段大小独立分片保存为 `.h264` / `.h265` 文件
- ✅ **自动上传**：录制完成后自动上传至阿里云盘,并删除本地文件.
- ✅ **轻量高效**：基于 C 语言开发，资源占用极低,可交叉编译至多平台

---

## 🛠 使用方法

### 1. 编译

使用 `clang` 编译：

```bash
clang mooncloud.c md5.c -o anrtsp
```
### 2. 使用参数
```bash
./anrtsp <IP地址[:端口]> <用户名> <密码> <RTSP路径>
```
### 3. 使用示例
```bash
# 连接IP摄像头示例
./anrtsp 192.168.1.100:554 admin password /h264

# 指定非标准端口示例
./anrtsp 192.168.1.100:5544 admin password /main
```
## 🛠 配置文件说明
### 程序使用 alipan_config.json 文件进行阿里云盘配置：
#### 必需配置项

| 参数 | 说明 | 示例 |
|------|------|------|
| `CLIENT_ID` | 阿里云盘开放平台申请的客户端ID | `"client_id": "your_client_id"` |
| `code` | 首次授权获取的认证代码 | `"code": "auth_code_from_browser"` |
| `client_secret` | 客户端密钥（请妥善保管） | `"client_secret": "your_secret"` |

### 自动生成项（无需手动配置）

以下参数会在首次运行时自动生成并写入配置文件：

| 参数 | 说明 |
|------|------|
| `ACCESS_TOKEN` | 访问令牌 |
| `REFRESH_TOKEN` | 刷新令牌 |
| `expire_time` | 令牌过期时间 |
| `drive_id` | 云盘ID |
| `parent_file_id` | 父文件夹ID |


## ❓ 常见问题

### Q: 首次运行如何获取授权代码？
**A:** 首次运行cloud.sh，程序会提供授权URL，在浏览器中打开并登录阿里云盘账号，授权后会跳转到一个页面，从URL参数中提取code值。

### Q: 视频分片策略是怎样的？
**A:** 默认按大小分片，每30mb左右钟创建一个新文件，也可在代码中修改分片策略。

### Q: 上传失败怎么办？
**A:** 检查网络连接，确认阿里云盘配置正确，特别是ACCESS_TOKEN是否有效。

## 📝 更新日志

### v1.0
- 初始版本发布
- 支持RTSP流捕获
- 实现视频分片保存
- 添加阿里云盘上传功能



## 🤝 贡献代码

欢迎提交Issue和Pull Request来改进本项目。